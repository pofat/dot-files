#!/usr/bin/env bash
set -euo pipefail

# client size
set +u
if [[ -n "$TMUX" ]]; then
  client_width="$(tmux list-clients -t '.' -F '#{client_width}')"
  client_height="$(tmux list-clients -t '.' -F '#{client_height}')"
else
  client_width=$(tput lines)
  client_height=$(tput cols)
fi
set -u

session_name='Xcode'
if tmux has-session -t ${session_name} &>/dev/null; then
  echo "session [${session_name}] already exisits, kill it!"
  tmux kill-session -t "${session_name}"
fi

#
# window: Log
#

root="${HOME}/Library/Logs/JacKit"
window_name='Log'
window="${session_name}:${window_name}"
mkdir -p "${root}" &>/dev/null
tmux new-session       \
  -s "${session_name}" \
  -n "${window_name}"  \
  -x "$client_width"   \
  -y "$client_height"  \
  -c "${root}"         \
  -d
sleep 1
tmux send-keys -t "${window}" "
jacsrv -p 8383
"

#
# window: Framework Projects
#

for window_name in iOSKit SocialKit RandomUser; do
  root="${HOME}/Develop/Apple/Frameworks/${window_name}"
  window="${session_name}:${window_name}"
  tmux new-window -a -d        \
    -t "${session_name}:{end}" \
    -n "${window_name}"        \
    -c "${root}"
  sleep 0.5
  tmux send-keys -t "${window}" "
  vv -O ${window_name}.podspec Example/Podfile
  "
done

tmux select-window -t "${session_name}:1.1"
echo "[${session_name}]"
tmux list-window -t "${session_name}" -F ' - #W'

